<section class="profile-page">
  <div class="container">
    <header class="profile-header">
      <div>
        <span class="pill">Account</span>
        <h2 class="profile-title">User Profile</h2>
        <p class="text-muted">Keep your details up to date for interviews and notifications.</p>
      </div>

      <div class="profile-header-actions">
        <button class="btn btn-ghost" type="button">Cancel</button>
        <button class="btn btn-primary" type="submit" form="profileForm" [disabled]="saving || form.invalid">
          @if (saving) { Saving… } @else { Save changes }
        </button>
      </div>
    </header>

    @if (loading) {
      <div class="status status--info">Loading your profile…</div>
    }

    @if (error) {
      <div class="status status--error">{{ error }}</div>
    }

    @if (success) {
      <div class="status status--success">{{ success }}</div>
    }

    @if (!loading) {
      <form
        id="profileForm"
        class="profile-card card"
        [formGroup]="form"
        (ngSubmit)="save()"
        novalidate
      >
        <div class="card-top">
          <div>
            <h3 class="card-title">Personal information</h3>
            <p class="text-muted">This information is used for identification and contact.</p>
          </div>
          <div class="card-badge">Secure</div>
        </div>

        <div class="profile-grid">
          <div class="form-group">
            <label>Username</label>
            <input class="input" formControlName="username" placeholder="your.username" />
          </div>

          <div class="form-group">
            <label>Email (identifier)</label>
            <input class="input" formControlName="email" readonly />
            <small class="hint">Email can’t be edited here.</small>
          </div>

          <div class="form-group">
            <label>First name</label>
            <input class="input" formControlName="firstName" placeholder="First Name" />
            @if (form.get('firstName')?.invalid && form.get('firstName')?.touched) {
              <small class="field-error">First name is required</small>
            }
          </div>

          <div class="form-group">
            <label>Last name</label>
            <input class="input" formControlName="lastName" placeholder="Last Name" />
            @if (form.get('lastName')?.invalid && form.get('lastName')?.touched) {
              <small class="field-error">Last name is required</small>
            }
          </div>

          <div class="form-group form-span-2">
            <label>Phone number (Tunisia)</label>

            <div class="phone-row">
              <span class="phone-prefix">+216</span>

              <input
                class="input phone-input"
                type="text"
                formControlName="phoneNational"
                placeholder="12345678"
                inputmode="numeric"
                pattern="\d*"
                maxlength="8"
                (input)="onPhoneInput($event)"
              />
            </div>

            @if (form.get('phoneNational')?.invalid && form.get('phoneNational')?.touched) {
              <small class="field-error">Enter exactly 8 digits.</small>
            }

            <small class="hint">
              Will be saved as: <span class="hint-strong">+216{{ form.get('phoneNational')?.value }}</span>
            </small>
          </div>
        </div>

        <div class="card-footer">
          <div class="text-muted">Changes are saved securely to your account.</div>
          <div class="footer-actions">
            <button class="btn btn-ghost" type="button">Cancel</button>
            <button class="btn btn-primary" type="submit" [disabled]="saving || form.invalid">
              @if (saving) { Saving… } @else { Save changes }
            </button>
          </div>
        </div>
      </form>
    }
  </div>
</section>
